# activate completion system.
autoload -Uz compinit
compinit

source $(brew --prefix)/opt/antidote/share/antidote/antidote.zsh
antidote load

if [ "$TERM_PROGRAM" != "Apple_Terminal" ]; then
  eval "$(oh-my-posh init zsh)"
fi

# enable interactive selection in tab auto complete
# stolen from https://github.com/zimfw/zimfw/blob/ab41c4484d3f3734a85a575e8d496406313ae274/modules/completion/init.zsh#L45
zstyle ':completion:*:*:*:*:*' menu select
zstyle ':completion:*:matches' group yes
zstyle ':completion:*:options' description yes
zstyle ':completion:*:options' auto-description '%d'
zstyle ':completion:*:corrections' format '%F{green}-- %d (errors: %e) --%f'
zstyle ':completion:*:descriptions' format '%F{yellow}-- %d --%f'
zstyle ':completion:*:messages' format '%F{purple}-- %d --%f'
zstyle ':completion:*:warnings' format '%F{red}-- no matches found --%f'
zstyle ':completion:*' format '%F{yellow}-- %d --%f'
zstyle ':completion:*' group-name ''
zstyle ':completion:*' verbose yes
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' '+r:|?=**'


# Directories
if (( ! ${+LS_COLORS} )); then
  # Locally use same LS_COLORS definition from utility module, in case it was not set
  local LS_COLORS='di=1;34:ln=35:so=32:pi=33:ex=31:bd=1;36:cd=1;33:su=30;41:sg=30;46:tw=30;42:ow=30;43'
fi
zstyle ':completion:*:default' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*:*:cd:*' tag-order local-directories directory-stack path-directories
zstyle ':completion:*:*:cd:*:directory-stack' menu yes select
zstyle ':completion:*:-tilde-:*' group-order 'named-directories' 'path-directories' 'expand'
zstyle ':completion:*' squeeze-slashes true

# enable caching
zstyle ':completion::complete:*' use-cache on
zstyle ':completion::complete:*' cache-path "${ZDOTDIR:-${HOME}}/.zcompcache"

# ignore useless commands and functions
zstyle ':completion:*:functions' ignored-patterns '(_*|pre(cmd|exec)|prompt_*)'

# completion sorting
zstyle ':completion:*:*:-subscript-:*' tag-order indexes parameters

# Man
zstyle ':completion:*:manuals' separate-sections true
zstyle ':completion:*:manuals.(^1*)' insert-sections true


# If the _my_hosts function is defined, it will be called to add the ssh hosts
# completion, otherwise _ssh_hosts will fall through and read the ~/.ssh/config
zstyle -e ':completion:*:*:ssh:*:my-accounts' users-hosts \
  '[[ -f ${HOME}/.ssh/config && ${key} == hosts ]] && key=my_hosts reply=()'


# set default editors (e.g. for what to use when running `git commit`)
export EDITOR="nvim"
export VISUAL="nvim"

if command -v fzf &> /dev/null
then
  source <(fzf --zsh)
fi

HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt appendhistory
setopt share_history


# enables `cd` without `cd`, i.e. `folder/to/go/to` is the same as `cd folder/to/go/to`
setopt autocd

# set this to not get git in swedish (main reason)
export LANG="en_US.UTF-8"

export PATH="$HOME/.bin:$PATH"
export PATH="$HOME/bin:$PATH"

bindkey "^[[H" beginning-of-line
bindkey "^[[F" end-of-line

# use eza instead of ls
if command -v eza &> /dev/null
then
  alias l="eza -1"
  alias ls="eza"
  alias ll="eza -al"
fi


# use bat instead of cat
if command -v bat &> /dev/null
then
  alias cat="bat"
fi

# use zoxide instead of cd
if command -v zoxide &> /dev/null
then
  eval "$(zoxide init zsh)"
fi


if command -v nvim &> /dev/null
then
  alias vi=nvim
  alias vim=nvim
fi


if command -v fnm &> /dev/null
then
  eval "$(fnm env)"
fi

alias gs="git status"
alias gc="git commit"

[ -s "$HOME/.env" ] && . "$HOME/.env"
